<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: client.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: client.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @namespace searchEngine
*/
var searchEngine = (function() {

  //setup some refrences that will be used 
  //across multiple functions
  var $form,
      $queryBox,
      $radius;

  /**
    * Initialize the search page
    *
    * @author Fleming Slone [fslone@gmail.com]
    * @memberof! searchEngine
   */
  function _init() {

    //cache some refrences that will be used 
    //across multiple functions
    $form = $("#queryForm");
    $queryBox = $form.find("#query_box");
    $radius = $form.find("#radius");
    
    _bindUI();

    _bindRefresh();

  }

  /**
    * Binds UI elements for the page
    *
    * @author Fleming Slone [fslone@gmail.com]
    * @memberof! searchEngine
   */
  function _bindUI() {

    //bind the search button
    $form
      .find(".btn-primary")
      .click(function(e) {    
        var query;
        e.preventDefault();    
        query = $queryBox.val();
        if(_validate(query)) _showSearchResults();
      });

    //bind the return key
    $queryBox
      .on("keypress", function(e) {
        var query;
        if(e.which===13) {
          query = $queryBox.val();
          if(_validate(query)) _showSearchResults();
        }
      });
  
  }

  /**
    * Re-populate the search box, etc. if the page is refreshed.
    *
    * @author Fleming Slone [fslone@gmail.com]
    * @memberof! searchEngine
   */
  function _bindRefresh() {

    $(window)
      .unload(function(){
        _setFormState();
      })
      .load(function() {
        _loadFromFormState();
      });

  }

  /**
    * Set formState object in localStorage to save last page visit
    *
    * @author Fleming Slone [fslone@gmail.com]
    * @memberof! searchEngine
   */
  function _setFormState() {

    var time, 
        queryVal, 
        formState;

    time = new Date().getTime();
    queryVal = $queryBox.val();
    
    formState = {
      query: queryVal,
      unloadTime: time
    };

    localStorage.setItem("formState", JSON.stringify(formState));

  }

  /**
    * Populate the page based on a formState object from localStorage 
    * if the last visit was less than 3 seconds ago (indicating a refresh)
    *
    * @author Fleming Slone [fslone@gmail.com]
    * @memberof! searchEngine
   */
  function _loadFromFormState() {

    var curTime, 
        formState, 
        unloadTime;
    
    curTime = new Date().getTime();

    formState = $.parseJSON(localStorage.getItem("formState"));
    
    if(formState) {

      unloadTime = formState.unloadTime;

      if((curTime - unloadTime) &lt; 3000) $queryBox.val(formState.query);

    }

  }

  /**
    * Validate the search box for completeness and proper email address
    *
    * @author Fleming Slone [fslone@gmail.com]
    * @returns {bool} Indicates whether the form was validated successfully or not
    * @memberof! searchEngine
   */
  function _validateForm(query) {

    var $errorSpan;

    $errorSpan = $form.find(".error-row span");

    if(!query) {

      $queryBox
        .closest(".form-group")
        .addClass("has-error");
      $errorSpan
        .text("Please enter an e-mail address.");

      return false;

    } else {

      $queryBox
        .closest(".form-group")
        .removeClass("has-error");
      $errorSpan
        .text("");

      return true;

    }

  }

  /**
    * Make a REST call via AJAX to fetch results from the server
    *
    * @param {string} query A query string generated by $.serialize
    * @returns {object} A promise object
    * @author Fleming Slone [fslone@gmail.com]
    * @memberof! searchEngine
   */
  function _getWikiResults(query) {
    
    var promise, 
        url;

    promise = $.Deferred();
    url = "/restapi/GetImage";

    $.ajax({
      cache: false,
      crossDomain: true,
      type: "GET",
      url: url + "?" + query,
      dataType: "text",
      success: function(json) {
        promise.resolve($.parseJSON(json));
      }, 
      error: function() {
        var errorRow;
        errorRow = _buildError();
        promise.resolve();
      }
    });

    return promise;

  }

  /**
    * Build an error 
    *
    * @param {string} errorCode The error code from the server.
    * @returns {string} A string of html to be appended to the page
    * @author Fleming Slone [fslone@gmail.com]
    * @memberof! searchEngine
   */
  function _buildError(errorCode) {
    
    var errorOpen, 
        errorClose, 
        cell1Open, 
        cell1Close, 
        cell2Open, 
        cell2Close, 
        error; 

    errorOpen = "&lt;div class='row'>";
    cell1Open = "&lt;div class='col-xs-12 alert alert-danger'>&lt;strong>";
    cell1Close = "&lt;/strong>&lt;/div>";
    errorClose = "&lt;/div>";

    error = errorOpen;
    error += cell1Open;
    error += "We're sorry, but there was a problem. Error code: " + errorCode
    error += cell1Close;
    error += errorClose;

    return error;

  }

  return {
    init: _init
  }

}());

searchEngine.init();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="searchEngine.html">searchEngine</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Thu Aug 13 2015 11:32:43 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
